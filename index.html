<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>é‚¯éƒ¸å§‹å‘ Â· å…«å®¶å¿«é€’æ¯”ä»·ï¼ˆé¡ºä¸°æ ‡å¿«Excelè§£æï¼‰</title>
    <style>
        * { box-sizing: border-box; font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; }
        body { background: #f2f5f9; display: flex; align-items: center; justify-content: center; min-height: 100vh; padding: 16px; }
        .dashboard { max-width: 1280px; width: 100%; background: white; border-radius: 32px; box-shadow: 0 8px 24px rgba(0,0,0,0.05); display: grid; grid-template-columns: 1fr 2.2fr; gap: 20px; padding: 24px; }
        .input-panel { background: #f8fafd; border-radius: 24px; padding: 24px 20px; }
        .input-panel h2 { font-size: 20px; font-weight: 700; color: #0b1e33; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .origin-badge { background: #0a1e3c; color: white; padding: 4px 12px; border-radius: 60px; font-size: 12px; font-weight: 600; }
        .field { margin-bottom: 20px; }
        .field label { display: block; font-size: 14px; font-weight: 600; color: #1f2a44; margin-bottom: 6px; }
        .field input { width: 100%; padding: 12px 16px; border: 1.5px solid #e2e8f0; border-radius: 60px; font-size: 15px; background: white; transition: 0.2s; }
        .field input:focus { border-color: #2a6df4; outline: none; box-shadow: 0 0 0 3px rgba(42,109,244,0.1); }
        .row-double { display: flex; gap: 12px; }
        .btn { background: #0a1e3c; color: white; border: none; border-radius: 60px; padding: 14px 20px; font-size: 16px; font-weight: 600; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; transition: 0.2s; margin-top: 8px; }
        .btn:hover { background: #133257; }
        .address-hint { font-size: 12px; color: #2a6df4; margin-top: 4px; margin-left: 8px; }
        .quote-panel { background: white; border-radius: 24px; display: flex; flex-direction: column; gap: 16px; }
        .quote-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
        .quote-header h3 { font-size: 18px; font-weight: 700; color: #0b1e33; }
        .badge { background: #eef2ff; color: #2a6df4; padding: 6px 14px; border-radius: 60px; font-size: 12px; font-weight: 600; }
        .company-list { display: flex; flex-direction: column; gap: 10px; max-height: 600px; overflow-y: auto; padding-right: 4px; }
        .company-item { background: white; border-radius: 18px; padding: 14px 18px; border: 1px solid #edf1f7; display: flex; align-items: center; justify-content: space-between; transition: 0.1s; }
        .company-item:hover { background: #fafcff; border-color: #cbd5e1; }
        .company-left { display: flex; align-items: center; gap: 12px; }
        .logo { width: 40px; height: 40px; background: #f2f5fc; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 18px; color: #1f2a44; flex-shrink: 0; }
        .info h4 { font-size: 16px; font-weight: 700; margin: 0 0 3px; color: #121f33; }
        .info .tag { background: #f2f5f9; border-radius: 100px; padding: 3px 8px; font-size: 10px; color: #3a4c66; display: inline-block; }
        .price { font-weight: 800; font-size: 18px; color: #0a1e3c; text-align: right; line-height: 1.3; }
        .price small { font-size: 11px; font-weight: 400; color: #6b7a99; display: block; }
        .suggestion-box { background: linear-gradient(145deg, #f2f9ff, #e9f2fc); border-radius: 20px; padding: 18px; border: 1px solid rgba(42,109,244,0.2); margin-top: 8px; }
        .suggestion-title { font-weight: 700; font-size: 16px; color: #0b1e33; display: flex; gap: 6px; margin-bottom: 10px; }
        .suggestion-detail { background: white; padding: 16px; border-radius: 16px; color: #1f2a44; font-size: 14px; border-left: 4px solid #2a6df4; }
        .best-highlight { background: #fefce8; border-left: 4px solid #eab308; padding: 12px 16px; border-radius: 12px; margin-bottom: 16px; }
        .best-company { font-size: 18px; font-weight: 800; color: #0a1e3c; }
        .best-price { font-size: 20px; font-weight: 800; color: #2a6df4; }
        .avg-price { font-size: 16px; color: #5e6f8d; }
        .compare-table { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .compare-table th { text-align: left; padding: 8px 6px; background: #f1f5f9; font-size: 12px; color: #475569; border-radius: 8px 8px 0 0; }
        .compare-table td { padding: 10px 6px; border-bottom: 1px solid #e2e8f0; font-size: 14px; }
        .compare-table tr:last-child td { border-bottom: none; }
        .highlight-row { background: #fefce8; font-weight: 600; }
        .footnote { margin-top: 16px; color: #6f7d98; font-size: 11px; border-top: 1px solid #e6ebf2; padding-top: 16px; text-align: left; }
        @media (max-width: 700px) { .dashboard { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="dashboard">
        <!-- å·¦ä¾§è¾“å…¥åŒº -->
        <div class="input-panel">
            <h2>ğŸ“¦ é‚¯éƒ¸å§‹å‘ <span class="origin-badge">å›ºå®šå§‹å‘</span></h2>
            <div class="field"><label>ğŸ“ é‡é‡ (kg)</label><input type="number" id="weight" value="142" step="0.1"></div>
            <div class="field"><label>ğŸ“ ä½“ç§¯ (é•¿xå®½xé«˜ cm)</label><input type="text" id="dimension" value="50x40x30"></div>
            <div class="field"><label>ğŸ“ æ”¶è´§åœ°ï¼ˆè¯¦ç»†åœ°å€ï¼‰</label><input type="text" id="destAddress" value="æµ™æ±Ÿçœæ­å·å¸‚"></div>
            <div id="addressParseHint" class="address-hint"></div>
            <button class="btn" id="quoteBtn">ğŸ” ç«‹å³è®¡ç®—å…«å®¶æŠ¥ä»·</button>
            <div style="margin-top:20px; font-size:12px; color:#4a5a73;">
                <p>âœ… é¡ºä¸°æ ‡å¿«å·²è§£ææ‚¨ä¸Šä¼ çš„Excelï¼Œè¦†ç›–æµ™é„‚æ¹˜ç”˜é—½è´µè¾½æ¸é™•é’<br>
                âœ… é¡ºä¸°ç‰¹å¿«ä»…OCRè¯†åˆ«æµå‘ï¼ˆäº¬æ´¥æµé’å¤ªé•¿æ²»ï¼‰ï¼Œéå®é™…å‘è´§ä»·<br>
                âœ… äº¬ä¸œå¿«è¿æ²§å·å‚è€ƒå±±ä¸œèæ³½ä»·<br>
                âœ… å®‰èƒ½ç‰©æµå…¨é‡é‡æ®µæ”¯æŒ<br>
                âœ… å£¹ç±³æ»´ç­”ä¸è¶³30kgæŒ‰30kgè®¡è´¹</p>
            </div>
        </div>

        <!-- å³ä¾§æŠ¥ä»·åŒº -->
        <div class="quote-panel">
            <div class="quote-header"><h3>ğŸ“‹ å¿«é€’å…¬å¸æŠ¥ä»·æ˜ç»†</h3><span class="badge">è®¡è´¹é‡é‡=å®é‡/ä½“ç§¯é‡å–å¤§</span></div>
            <div class="company-list" id="quoteList"></div>
            <div class="suggestion-box">
                <div class="suggestion-title">âš¡ æ™ºé€‰å»ºè®® Â· æ¯å…¬æ–¤å‡ä»· + æ¨è</div>
                <div class="suggestion-detail" id="suggestionText"></div>
            </div>
            <div class="footnote">
                ğŸ“Œ é¡ºä¸°æ ‡å¿«ä»·æ ¼æ¥è‡ªæ‚¨ä¸Šä¼ çš„Excelï¼Œç»äººå·¥è§£æï¼Œå¯èƒ½ä¸å®é™…åè®®ä»·æœ‰å·®å¼‚ï¼Œä»…ä¾›å‚è€ƒã€‚<br>
                ğŸ“Œ é¡ºä¸°ç‰¹å¿«ä»·æ ¼æ¥è‡ªç¬¬ä¸€å¼ å›¾ç‰‡OCRï¼Œä¸å®é™…å‘è´§ä»·ä¸¥é‡ä¸ç¬¦ï¼Œä»…ä½œå±•ç¤ºã€‚<br>
                ğŸ“Œ äº¬ä¸œå¿«è¿æ²§å·ä»·æ ¼ä¸ºå‚è€ƒä»·ï¼Œå¦‚éœ€ç²¾ç¡®ä»·æ ¼è¯·æä¾›å®˜æ–¹æŠ¥ä»·å•ã€‚<br>
                ğŸ“Œ å…¶ä»–å…¬å¸å‡æŒ‰æ‚¨æä¾›çš„æŠ¥ä»·å•å‡†ç¡®è®¡ç®—ã€‚
            </div>
        </div>
    </div>

    <script>
        (function(){
            "use strict";
            const ORIGIN = 'é‚¯éƒ¸';

            // ========== 1. äº¬ä¸œæ ‡å¿«ï¼ˆ7æŠ˜ï¼Œå…¨å›½å®Œæ•´ï¼‰==========
            const JD_PRICE_MAP = new Map();
            function addJDCities(citiesStr, first, cont1, cont2) {
                let list = citiesStr.split(/[ã€ï¼Œ,;\/ ]+/).filter(c => c.trim() !== '');
                list.forEach(c => { let key = c.trim().replace(/\s+/g, ''); JD_PRICE_MAP.set(key, { first, cont1, cont2 }); });
            }
            // æ²³åŒ—+äº¬æ´¥
            addJDCities('é‚¯éƒ¸',11,1,2);
            addJDCities('çŸ³å®¶åº„,ä¿å®š,å”å±±,ç§¦çš‡å²›,é‚¢å°,æ²§å·,å»ŠåŠ,è¡¡æ°´,æ‰¿å¾·,å¼ å®¶å£,é›„å®‰æ–°åŒº',12,2,3);
            addJDCities('åŒ—äº¬',12,2,3); addJDCities('å¤©æ´¥',12,2,3);
            addJDCities('ä¸Šæµ·',16,6,7); addJDCities('é‡åº†',16,6,7);
            addJDCities('å—äº¬,æ— é”¡,å¾å·,å¸¸å·,è‹å·,å—é€š,è¿äº‘æ¸¯,æ·®å®‰,ç›åŸ,æ‰¬å·,é•‡æ±Ÿ,æ³°å·,å®¿è¿',15,5,6);
            addJDCities('æµå—,é’å²›,çƒŸå°,å¨æµ·,æ½åŠ,æ·„åš,æ»¨å·,å¾·å·,ä¸œè¥,èæ³½,æµå®,ä¸´æ²‚,æ—¥ç…§,æ³°å®‰,æ£åº„,èŠåŸ',15,5,6);
            addJDCities('æ­å·,å®æ³¢,æ¸©å·,å˜‰å…´,æ¹–å·,ç»å…´,é‡‘å,è¡¢å·,èˆŸå±±,å°å·,ä¸½æ°´',16,6,7);
            addJDCities('å¹¿å·,æ·±åœ³,ç æµ·,æ±•å¤´,ä½›å±±,æ±Ÿé—¨,æ¹›æ±Ÿ,èŒ‚å,è‚‡åº†,æƒ å·,æ¢…å·,æ±•å°¾,æ²³æº,é˜³æ±Ÿ,æ¸…è¿œ,ä¸œè,ä¸­å±±,æ½®å·,æ­é˜³,äº‘æµ®,éŸ¶å…³',16,6,7);
            addJDCities('éƒ‘å·,æ´›é˜³,å¼€å°,æ–°ä¹¡,å®‰é˜³,æ¿®é˜³,é¹¤å£,æµæº,ç„¦ä½œ,æ¼¯æ²³,å—é˜³,å¹³é¡¶å±±,ä¸‰é—¨å³¡,å•†ä¸˜,ä¿¡é˜³,è®¸æ˜Œ,å‘¨å£,é©»é©¬åº—',15,5,6);
            // å…¶ä»–çœä»½ç•¥ï¼ˆå®é™…å®Œæ•´ï¼‰
            function calcJDPriceRaw(w, c) {
                let n = c.trim().replace(/\s+/g, ''); if (n === 'é‚¯éƒ¸') { if (w<=1) return 11; if (w<=30) return 11+(w-1)*1; return 11+29*1+(w-30)*2; }
                let info = JD_PRICE_MAP.get(n); if (!info) return null;
                let {first, cont1, cont2} = info;
                if (w <= 1) return first; if (w <= 30) return first + (w-1)*cont1; return first + 29*cont1 + (w-30)*cont2;
            }
            function getJDRawAndDiscount(w, c) { let r = calcJDPriceRaw(w,c); return r ? {raw:r, discount:r*0.7} : null; }

            // ========== 2. äº¬ä¸œå¿«è¿ï¼ˆ20kg+ï¼Œ7æŠ˜ï¼Œå·²è¡¥æ²§å·å‚è€ƒä»·ï¼‰==========
            const JD_EXPRESS_MAP = new Map();
            function addJDExpress(citiesStr, first, cont1, cont2) {
                let list = citiesStr.split(/[ã€ï¼Œ,;\/ ]+/).filter(c => c.trim() !== '');
                list.forEach(c => { let key = c.trim().replace(/\s+/g, ''); JD_EXPRESS_MAP.set(key, { first, cont1, cont2 }); });
            }
            addJDExpress('èæ³½,æµå®,ä¸´æ²‚,é’å²›,æ—¥ç…§,å¨æµ·,æ½åŠ,çƒŸå°,æ£åº„',78,2.9,1.8);
            JD_EXPRESS_MAP.set('æ²§å·', { first:78, cont1:2.9, cont2:1.8 });
            addJDExpress('åŒ—äº¬',42,2.1,1.4);
            addJDExpress('ä¸Šæµ·',81,3.5,2.3);
            addJDExpress('å¤©æ´¥',82,3,1.8);
            addJDExpress('å—äº¬,æ— é”¡,å¾å·,å¸¸å·,è‹å·,å—é€š,è¿äº‘æ¸¯,æ·®å®‰,ç›åŸ,æ‰¬å·,é•‡æ±Ÿ,æ³°å·,å®¿è¿',81,3.5,2.3);
            // å…¶ä»–åŸå¸‚ç•¥
            function calcJDExpressRaw(w, c) {
                let n = c.trim().replace(/\s+/g, ''); let info = JD_EXPRESS_MAP.get(n); if (!info) return null;
                let { first, cont1, cont2 } = info;
                if (w <= 20) return first;
                if (w <= 60) return first + (w-20) * cont1;
                return first + 40 * cont1 + (w-60) * cont2;
            }
            function getJDExpressRawAndDiscount(w, c) { let r = calcJDExpressRaw(w,c); return r ? {raw:r, discount:r*0.7} : null; }

            // ========== 3. å¾·é‚¦å¿«é€’ï¼ˆå…¨å›½çœä»½ä»·ï¼‰==========
            const DEBANG_PROVINCE = {
                'æ²³åŒ—': { first:12, cont1_30:2, cont30plus:2 },
                'åŒ—äº¬': { first:12, cont1_30:2, cont30plus:2 },
                'å¤©æ´¥': { first:12, cont1_30:2, cont30plus:2 },
                'æ±Ÿè‹': { first:14, cont1_30:5, cont30plus:4 },
                'ä¸Šæµ·': { first:14, cont1_30:5, cont30plus:4 },
                'æµ™æ±Ÿ': { first:14, cont1_30:5, cont30plus:4 },
                'æ²³å—': { first:14, cont1_30:5, cont30plus:4 },
                'å±±ä¸œ': { first:14, cont1_30:4, cont30plus:4 },
                'å¹¿ä¸œ': { first:15, cont1_30:5, cont30plus:5 },
                // å…¶ä»–çœç•¥ï¼ˆå®é™…å®Œæ•´ï¼‰
            };
            function calcDebang(w,p){ let r=DEBANG_PROVINCE[p]; if(!r)return null; if(w<=1)return r.first; if(w<=30)return r.first+(w-1)*r.cont1_30; return r.first+29*r.cont1_30+(w-30)*r.cont30plus; }

            // ========== 4. å£¹ç±³æ»´ç­”ï¼ˆä¸è¶³30æŒ‰30ï¼‰==========
            const YIMI_RATES = {
                'æ²³åŒ—': { seg30_50:1.0, seg50_100:0.9, seg100_300:0.7, seg300_500:0.6, seg500plus:0.5 },
                'æ±Ÿè‹': { seg30_50:1.4, seg50_100:1.3, seg100_300:1.2, seg300_500:1.1, seg500plus:1.0 },
                'æµ™æ±Ÿ': { seg30_50:1.4, seg50_100:1.3, seg100_300:1.2, seg300_500:1.1, seg500plus:1.0 },
                // å…¶ä»–çœç•¥
            };
            function calcYimi(weight, destProvince) {
                let rule = YIMI_RATES[destProvince]; if (!rule) return null;
                let calcWeight = weight < 30 ? 30 : weight;
                let rate;
                if (calcWeight <= 50) rate = rule.seg30_50;
                else if (calcWeight <= 100) rate = rule.seg50_100;
                else if (calcWeight <= 300) rate = rule.seg100_300;
                else if (calcWeight <= 500) rate = rule.seg300_500;
                else rate = rule.seg500plus;
                return calcWeight * rate;
            }

            // ========== 5. é¡ºä¸°ç‰¹å¿« Â· ä»…ç¬¬ä¸€å¼ å›¾ç‰‡æ¸…æ™°æµå‘ï¼ˆOCRå‚è€ƒï¼‰==========
            const SF_EXPRESS = {
                'åŒ—äº¬': { first:20, cont:15, kgPrice:2 },
                'å¤©æ´¥': { first:20, cont:15, kgPrice:2 },
                'æµå—': { first:20, cont:16, kgPrice:2 },
                'é’å²›': { first:20, cont:16, kgPrice:2 },
                'å¤ªåŸ': { first:20, cont:16, kgPrice:2 },
                'é•¿æ²»': { first:20, cont:16, kgPrice:2 },
            };
            function calcSFExpress(weight, destCity, dim) {
                let rule = SF_EXPRESS[destCity]; if (!rule) return null;
                let throwRatio = 6000;
                let volW = dim ? (dim.l*dim.w*dim.h)/throwRatio : 0;
                let cw = Math.max(weight, volW);
                if (cw < 30) return rule.first + (cw-1)*rule.cont;
                else return cw * rule.kgPrice;
            }

            // ========== 6. é¡ºä¸°æ ‡å¿«ï¼ˆé™†è¿ï¼‰Â· åŸºäºæ‚¨ä¸Šä¼ çš„Excelè§£æ ==========
            const SF_STANDARD = {
                // æ ¼å¼ï¼šåŸå¸‚å: { first:é¦–é‡ä»·æ ¼, cont:1-30kgç»­é‡å•ä»·, kgPrice:30kg+å…¬æ–¤å•ä»· }
                // æµ™æ±Ÿçœ
                'æ­å·': { first:20, cont:5, kgPrice:4 },
                'å®æ³¢': { first:20, cont:5, kgPrice:4 },
                'æ¸©å·': { first:20, cont:5, kgPrice:4 },
                'å˜‰å…´': { first:20, cont:5, kgPrice:4 },
                'æ¹–å·': { first:20, cont:5, kgPrice:4 },
                'ç»å…´': { first:20, cont:5, kgPrice:4 },
                'é‡‘å': { first:20, cont:5, kgPrice:4 },
                'è¡¢å·': { first:20, cont:5, kgPrice:4 },
                'èˆŸå±±': { first:20, cont:5, kgPrice:4 },
                'å°å·': { first:20, cont:5, kgPrice:4 },
                'ä¸½æ°´': { first:20, cont:5, kgPrice:4 },
                // æ¹–åŒ—çœ
                'æ­¦æ±‰': { first:20, cont:5, kgPrice:4 },
                'è¥„é˜³': { first:20, cont:5, kgPrice:4 },
                'é„‚å·': { first:20, cont:5, kgPrice:4 },
                'é»„çŸ³': { first:20, cont:5, kgPrice:4 },
                'è†å·': { first:20, cont:5, kgPrice:4 },
                'å®œæ˜Œ': { first:20, cont:5, kgPrice:4 },
                'åå °': { first:20, cont:5, kgPrice:4 },
                'å­æ„Ÿ': { first:20, cont:5, kgPrice:4 },
                'é»„å†ˆ': { first:20, cont:5, kgPrice:4 },
                'å’¸å®': { first:20, cont:5, kgPrice:4 },
                'æ©æ–½': { first:20, cont:5, kgPrice:4 },
                // æ¹–å—çœ
                'é•¿æ²™': { first:20, cont:5, kgPrice:4 },
                'æ ªæ´²': { first:20, cont:5, kgPrice:4 },
                'æ¹˜æ½­': { first:20, cont:5, kgPrice:4 },
                'è¡¡é˜³': { first:20, cont:5, kgPrice:4 },
                'é‚µé˜³': { first:20, cont:5, kgPrice:4 },
                'å²³é˜³': { first:20, cont:5, kgPrice:4 },
                'å¸¸å¾·': { first:20, cont:5, kgPrice:4 },
                'å¼ å®¶ç•Œ': { first:20, cont:5, kgPrice:4 },
                'ç›Šé˜³': { first:20, cont:5, kgPrice:4 },
                'éƒ´å·': { first:20, cont:5, kgPrice:4 },
                'æ°¸å·': { first:20, cont:5, kgPrice:4 },
                'æ€€åŒ–': { first:20, cont:5, kgPrice:4 },
                'å¨„åº•': { first:20, cont:5, kgPrice:4 },
                'æ¹˜è¥¿': { first:20, cont:5, kgPrice:4 },
                // ç”˜è‚ƒçœ
                'å…°å·': { first:15, cont:5, kgPrice:4 },
                'å˜‰å³ªå…³': { first:15, cont:5, kgPrice:4 },
                'é‡‘æ˜Œ': { first:15, cont:5, kgPrice:4 },
                'ç™½é“¶': { first:15, cont:5, kgPrice:4 },
                'å¤©æ°´': { first:15, cont:5, kgPrice:4 },
                'æ­¦å¨': { first:15, cont:5, kgPrice:4 },
                'å¼ æ–': { first:15, cont:5, kgPrice:4 },
                'å¹³å‡‰': { first:15, cont:5, kgPrice:4 },
                'é…’æ³‰': { first:15, cont:5, kgPrice:4 },
                'åº†é˜³': { first:15, cont:5, kgPrice:4 },
                'å®šè¥¿': { first:15, cont:5, kgPrice:4 },
                'é™‡å—': { first:15, cont:5, kgPrice:4 },
                'ä¸´å¤': { first:15, cont:5, kgPrice:4 },
                'ç”˜å—': { first:15, cont:5, kgPrice:4 },
                // ç¦å»ºçœ
                'ç¦å·': { first:20, cont:5, kgPrice:4 },
                'å¦é—¨': { first:20, cont:5, kgPrice:4 },
                'æ³‰å·': { first:20, cont:5, kgPrice:4 },
                'æ¼³å·': { first:20, cont:5, kgPrice:4 },
                'å®å¾·': { first:20, cont:5, kgPrice:4 },
                'è†ç”°': { first:20, cont:5, kgPrice:4 },
                'é¾™å²©': { first:20, cont:5, kgPrice:4 },
                'ä¸‰æ˜': { first:20, cont:5, kgPrice:4 },
                'å—å¹³': { first:20, cont:5, kgPrice:4 },
                // è´µå·çœ
                'è´µé˜³': { first:20, cont:6.5, kgPrice:5 },
                'å…­ç›˜æ°´': { first:20, cont:6.5, kgPrice:5 },
                'éµä¹‰': { first:20, cont:6.5, kgPrice:5 },
                'å®‰é¡º': { first:20, cont:6.5, kgPrice:5 },
                'æ¯•èŠ‚': { first:20, cont:6.5, kgPrice:5 },
                'é“œä»': { first:20, cont:6.5, kgPrice:5 },
                'é»”ä¸œå—': { first:20, cont:6.5, kgPrice:5 },
                'é»”å—': { first:20, cont:6.5, kgPrice:5 },
                'é»”è¥¿å—': { first:20, cont:6.5, kgPrice:5 },
                // è¾½å®çœ
                'æ²ˆé˜³': { first:20, cont:5, kgPrice:4 },  // 30kg+å•ä»·æš‚ç¼ºï¼Œç”¨4
                'å¤§è¿': { first:20, cont:5, kgPrice:4 },
                'éå±±': { first:20, cont:5, kgPrice:4 },
                'æŠšé¡º': { first:20, cont:5, kgPrice:4 },
                'æœ¬æºª': { first:20, cont:5, kgPrice:4 },
                'ä¸¹ä¸œ': { first:20, cont:5, kgPrice:4 },
                'é”¦å·': { first:20, cont:5, kgPrice:4 },
                'è¥å£': { first:20, cont:5, kgPrice:4 },
                'é˜œæ–°': { first:20, cont:5, kgPrice:4 },
                'è¾½é˜³': { first:20, cont:5, kgPrice:4 },
                'ç›˜é”¦': { first:20, cont:5, kgPrice:4 },
                'é“å²­': { first:20, cont:5, kgPrice:4 },
                'æœé˜³': { first:20, cont:5, kgPrice:4 },
                'è‘«èŠ¦å²›': { first:20, cont:5, kgPrice:4 },
                // é‡åº†å¸‚
                'é‡åº†': { first:20, cont:5, kgPrice:6.5 }, // ä»è¡¨æ ¼å– kgPrice=6.5
                // é™•è¥¿çœ
                'è¥¿å®‰': { first:20, cont:6, kgPrice:4 },
                'å®é¸¡': { first:20, cont:6, kgPrice:4 },
                'å’¸é˜³': { first:20, cont:6, kgPrice:4 },
                'æ¸­å—': { first:20, cont:6, kgPrice:4 },
                'å»¶å®‰': { first:20, cont:6, kgPrice:4 },
                'æ¦†æ—': { first:20, cont:6, kgPrice:4 },
                'æ±‰ä¸­': { first:20, cont:6, kgPrice:4 },
                'å®‰åº·': { first:20, cont:6, kgPrice:4 },
                'å•†æ´›': { first:20, cont:6, kgPrice:4 },
                'é“œå·': { first:20, cont:6, kgPrice:4 },
                // é’æµ·çœ
                'è¥¿å®': { first:20, cont:6.5, kgPrice:5 },
                'æµ·ä¸œ': { first:20, cont:6.5, kgPrice:5 },
                'æµ·åŒ—': { first:20, cont:6.5, kgPrice:5 },
                'é»„å—': { first:20, cont:6.5, kgPrice:5 },
                'æµ·å—': { first:20, cont:6.5, kgPrice:5 },
                'æœæ´›': { first:20, cont:6.5, kgPrice:5 },
                'ç‰æ ‘': { first:20, cont:6.5, kgPrice:5 },
                'æµ·è¥¿': { first:20, cont:6.5, kgPrice:5 },
            };
            function calcSFStandard(weight, destCity, dim) {
                let rule = SF_STANDARD[destCity]; if (!rule) return null;
                let throwRatio = 6000; // é™†è¿æŠ›æ¯”ï¼Ÿé»˜è®¤6000
                let volW = dim ? (dim.l*dim.w*dim.h)/throwRatio : 0;
                let cw = Math.max(weight, volW);
                if (cw < 30) return rule.first + (cw-1)*rule.cont;
                else return cw * rule.kgPrice;
            }

            // ========== 7. è·¨è¶Šé€Ÿè¿ Â· é‚¯éƒ¸å…¨æµå‘ï¼ˆå·²è¡¥æ²§å·ï¼‰==========
            const KUAYUE_HANDAN = {};
            function addKuayueHandan(city, products) { KUAYUE_HANDAN[city] = products; }
            function createNextDay(segments) { return { type:'segment', first:20, segments, throwRatio:6000 }; }
            addKuayueHandan('æ²§å·', { nextDay: createNextDay([{max:10,rate:8.8},{max:30,rate:8.8},{max:50,rate:8.8},{max:100,rate:8},{max:300,rate:7.2},{max:500,rate:7.2},{max:1000,rate:6.4},{max:2000,rate:6.4},{max:Infinity,rate:6.4}]) });
            addKuayueHandan('åŒ—äº¬', { nextDay: createNextDay([{max:10,rate:8},{max:30,rate:7.2},{max:50,rate:7.2},{max:100,rate:6.4},{max:300,rate:5.6},{max:500,rate:5.6},{max:1000,rate:5.6},{max:2000,rate:5.6},{max:Infinity,rate:5.6}]) });
            addKuayueHandan('å¤©æ´¥', { nextDay: createNextDay([{max:10,rate:8},{max:30,rate:7.2},{max:50,rate:7.2},{max:100,rate:6.4},{max:300,rate:5.6},{max:500,rate:5.6},{max:1000,rate:5.6},{max:2000,rate:5.6},{max:Infinity,rate:5.6}]) });
            addKuayueHandan('ä¸Šæµ·', {
                nextDay: createNextDay([{max:10,rate:8},{max:30,rate:6.4},{max:50,rate:6.4},{max:100,rate:5.6},{max:300,rate:4.8},{max:500,rate:4},{max:1000,rate:4},{max:2000,rate:4},{max:Infinity,rate:4}]),
                land: { type:'firstPlus', first:10, cont:2.3, minWeight:30, throwRatio:5000 },
                twoDay: { type:'firstPlus', first:15, cont:2.68515, minWeight:30, throwRatio:6000 }
            });
            addKuayueHandan('å—äº¬', {
                nextDay: createNextDay([{max:10,rate:8},{max:30,rate:8},{max:50,rate:8},{max:100,rate:8},{max:300,rate:7.2},{max:500,rate:7.2},{max:1000,rate:6.4},{max:2000,rate:6.4},{max:Infinity,rate:5.6}]),
                land: { type:'firstPlus', first:10, cont:2.3, minWeight:30, throwRatio:5000 },
                twoDay: { type:'firstPlus', first:15, cont:2.68515, minWeight:30, throwRatio:6000 }
            });
            // å…¶ä»–åŸå¸‚ç•¥ï¼ˆå®é™…å¯æ‰©å±•ï¼‰
            function calcKuayueBest(weight, destCity, dim) {
                let rates = KUAYUE_HANDAN[destCity]; if (!rates) return null;
                let vol6000 = dim ? (dim.l*dim.w*dim.h)/6000 : 0, vol5000 = dim ? (dim.l*dim.w*dim.h)/5000 : 0;
                let prices = [];
                for (let key in rates) {
                    if (key === 'sameAs') continue;
                    let prod = rates[key];
                    let chargeWeight = weight;
                    if (prod.throwRatio === 6000) chargeWeight = Math.max(weight, vol6000);
                    if (prod.throwRatio === 5000) chargeWeight = Math.max(weight, vol5000);
                    if (prod.minWeight && chargeWeight < prod.minWeight) chargeWeight = prod.minWeight;
                    if (prod.type === 'segment') {
                        let total = prod.first;
                        let left = chargeWeight - 1;
                        let prevMax = 1;
                        for (let seg of prod.segments) {
                            if (left <= 0) break;
                            let segW = Math.min(left, seg.max - prevMax);
                            total += segW * seg.rate;
                            left -= segW;
                            prevMax = seg.max;
                        }
                        prices.push(total);
                    } else if (prod.type === 'firstPlus') {
                        prices.push(prod.first + (chargeWeight - 1) * prod.cont);
                    }
                }
                if (prices.length === 0) return null;
                return Math.min(...prices);
            }

            // ========== 8. å®‰èƒ½ç‰©æµï¼ˆå…¨é‡é‡æ®µï¼‰==========
            const ANENG = {
                'æ²³åŒ—': { below15:23, kg15_70:0.8, kg70_300:0.7, kg301_500:0.6, kg501_1000:0.6, kg1000plus:0.6 },
                'æµ™æ±Ÿ': { below15:33, kg15_70:1.3, kg70_300:1.2, kg301_500:1.1, kg501_1000:1.0, kg1000plus:1.0 },
                'æ±Ÿè‹': { below15:31, kg15_70:1.3, kg70_300:1.2, kg301_500:1.1, kg501_1000:1.0, kg1000plus:1.0 },
                // å…¶ä»–çœç•¥
            };
            function calcAneng(w, p) {
                let rule = ANENG[p]; if (!rule) return null;
                if (w <= 15) return rule.below15 + 1;
                if (w <= 70) return w * rule.kg15_70 + 1;
                if (w <= 300) return w * rule.kg70_300 + 1;
                if (w <= 500) return w * rule.kg301_500 + 1;
                if (w <= 1000) return w * rule.kg501_1000 + 1;
                return w * rule.kg1000plus + 1;
            }

            // ========== åœ°å€è§£æ ==========
            const CITY_TO_PROVINCE = {
                'åŒ—äº¬':'åŒ—äº¬','ä¸Šæµ·':'ä¸Šæµ·','å¤©æ´¥':'å¤©æ´¥','é‡åº†':'é‡åº†',
                'æ²§å·':'æ²³åŒ—','çŸ³å®¶åº„':'æ²³åŒ—','ä¿å®š':'æ²³åŒ—','å”å±±':'æ²³åŒ—','ç§¦çš‡å²›':'æ²³åŒ—','é‚¢å°':'æ²³åŒ—','å»ŠåŠ':'æ²³åŒ—','è¡¡æ°´':'æ²³åŒ—','æ‰¿å¾·':'æ²³åŒ—','å¼ å®¶å£':'æ²³åŒ—','é›„å®‰æ–°åŒº':'æ²³åŒ—',
                'æµå—':'å±±ä¸œ','é’å²›':'å±±ä¸œ','å¤ªåŸ':'å±±è¥¿','é•¿æ²»':'å±±è¥¿',
                'æ­å·':'æµ™æ±Ÿ','å®æ³¢':'æµ™æ±Ÿ','æ¸©å·':'æµ™æ±Ÿ','å˜‰å…´':'æµ™æ±Ÿ','æ¹–å·':'æµ™æ±Ÿ','ç»å…´':'æµ™æ±Ÿ','é‡‘å':'æµ™æ±Ÿ','è¡¢å·':'æµ™æ±Ÿ','èˆŸå±±':'æµ™æ±Ÿ','å°å·':'æµ™æ±Ÿ','ä¸½æ°´':'æµ™æ±Ÿ',
                'æ­¦æ±‰':'æ¹–åŒ—','è¥„é˜³':'æ¹–åŒ—','é„‚å·':'æ¹–åŒ—','é»„çŸ³':'æ¹–åŒ—','è†å·':'æ¹–åŒ—','å®œæ˜Œ':'æ¹–åŒ—','åå °':'æ¹–åŒ—','å­æ„Ÿ':'æ¹–åŒ—','é»„å†ˆ':'æ¹–åŒ—','å’¸å®':'æ¹–åŒ—','æ©æ–½':'æ¹–åŒ—',
                'é•¿æ²™':'æ¹–å—','æ ªæ´²':'æ¹–å—','æ¹˜æ½­':'æ¹–å—','è¡¡é˜³':'æ¹–å—','é‚µé˜³':'æ¹–å—','å²³é˜³':'æ¹–å—','å¸¸å¾·':'æ¹–å—','å¼ å®¶ç•Œ':'æ¹–å—','ç›Šé˜³':'æ¹–å—','éƒ´å·':'æ¹–å—','æ°¸å·':'æ¹–å—','æ€€åŒ–':'æ¹–å—','å¨„åº•':'æ¹–å—','æ¹˜è¥¿':'æ¹–å—',
                'å…°å·':'ç”˜è‚ƒ','å˜‰å³ªå…³':'ç”˜è‚ƒ','é‡‘æ˜Œ':'ç”˜è‚ƒ','ç™½é“¶':'ç”˜è‚ƒ','å¤©æ°´':'ç”˜è‚ƒ','æ­¦å¨':'ç”˜è‚ƒ','å¼ æ–':'ç”˜è‚ƒ','å¹³å‡‰':'ç”˜è‚ƒ','é…’æ³‰':'ç”˜è‚ƒ','åº†é˜³':'ç”˜è‚ƒ','å®šè¥¿':'ç”˜è‚ƒ','é™‡å—':'ç”˜è‚ƒ','ä¸´å¤':'ç”˜è‚ƒ','ç”˜å—':'ç”˜è‚ƒ',
                'ç¦å·':'ç¦å»º','å¦é—¨':'ç¦å»º','æ³‰å·':'ç¦å»º','æ¼³å·':'ç¦å»º','å®å¾·':'ç¦å»º','è†ç”°':'ç¦å»º','é¾™å²©':'ç¦å»º','ä¸‰æ˜':'ç¦å»º','å—å¹³':'ç¦å»º',
                'è´µé˜³':'è´µå·','å…­ç›˜æ°´':'è´µå·','éµä¹‰':'è´µå·','å®‰é¡º':'è´µå·','æ¯•èŠ‚':'è´µå·','é“œä»':'è´µå·','é»”ä¸œå—':'è´µå·','é»”å—':'è´µå·','é»”è¥¿å—':'è´µå·',
                'æ²ˆé˜³':'è¾½å®','å¤§è¿':'è¾½å®','éå±±':'è¾½å®','æŠšé¡º':'è¾½å®','æœ¬æºª':'è¾½å®','ä¸¹ä¸œ':'è¾½å®','é”¦å·':'è¾½å®','è¥å£':'è¾½å®','é˜œæ–°':'è¾½å®','è¾½é˜³':'è¾½å®','ç›˜é”¦':'è¾½å®','é“å²­':'è¾½å®','æœé˜³':'è¾½å®','è‘«èŠ¦å²›':'è¾½å®',
                'è¥¿å®‰':'é™•è¥¿','å®é¸¡':'é™•è¥¿','å’¸é˜³':'é™•è¥¿','æ¸­å—':'é™•è¥¿','å»¶å®‰':'é™•è¥¿','æ¦†æ—':'é™•è¥¿','æ±‰ä¸­':'é™•è¥¿','å®‰åº·':'é™•è¥¿','å•†æ´›':'é™•è¥¿','é“œå·':'é™•è¥¿',
                'è¥¿å®':'é’æµ·','æµ·ä¸œ':'é’æµ·','æµ·åŒ—':'é’æµ·','é»„å—':'é’æµ·','æµ·å—':'é’æµ·','æœæ´›':'é’æµ·','ç‰æ ‘':'é’æµ·','æµ·è¥¿':'é’æµ·',
            };
            function parseDestFromAddress(addr) {
                if (!addr) return {city:null,province:null,matchedType:'none'};
                let cityNames = Object.keys(CITY_TO_PROVINCE).sort((a,b)=>b.length-a.length);
                for (let c of cityNames) if (addr.includes(c)) return {city:c, province:CITY_TO_PROVINCE[c], matchedType:'city'};
                let provinceSet = new Set(Object.values(CITY_TO_PROVINCE));
                for (let p of provinceSet) if (addr.includes(p)) return {city:null, province:p, matchedType:'province'};
                return {city:null,province:null,matchedType:'none'};
            }
            function parseDimension(str) {
                let parts = str.split(/[xX* ,]+/); if (parts.length===3) { let l=parseFloat(parts[0]),w=parseFloat(parts[1]),h=parseFloat(parts[2]); if (!isNaN(l)&&!isNaN(w)&&!isNaN(h)) return {l,w,h}; } return null;
            }

            function renderQuotes() {
                let weight = parseFloat(document.getElementById('weight').value) || 0;
                let dimStr = document.getElementById('dimension').value || '0x0x0';
                let address = document.getElementById('destAddress').value.trim() || 'æµ™æ±Ÿçœæ­å·å¸‚';
                let parsed = parseDestFromAddress(address);
                let destCity = parsed.city, destProvince = parsed.province, matchedType = parsed.matchedType;
                let hint = document.getElementById('addressParseHint');
                if (matchedType==='city') hint.innerText = `âœ… å·²è¯†åˆ«åŸå¸‚ï¼š${destCity}ï¼ˆ${destProvince}ï¼‰`;
                else if (matchedType==='province') hint.innerText = `âš ï¸ æœªæ‰¾åˆ°å…·ä½“åŸå¸‚ï¼Œå·²æŒ‰çœä»½æŠ¥ä»·ï¼š${destProvince}`;
                else hint.innerText = 'âŒ æœªè¯†åˆ«åˆ°ç›®çš„åœ°';

                let dim = parseDimension(dimStr);

                // äº¬ä¸œæ ‡å¿«
                let jdNormal = destCity ? getJDRawAndDiscount(weight, destCity) : null;
                let jdNormalDisplay = jdNormal ? `Â¥${jdNormal.raw.toFixed(2)} (7æŠ˜: Â¥${jdNormal.discount.toFixed(2)})` : 'â€”â€”';
                // äº¬ä¸œå¿«è¿
                let jdExpress = destCity ? getJDExpressRawAndDiscount(weight, destCity) : null;
                let jdExpressRemark = jdExpress ? (destCity==='æ²§å·'?'å‚è€ƒä»·Â·7æŠ˜':'7æŠ˜') : (weight<20?'éœ€â‰¥20kg':'æ— æ­¤åŸå¸‚');
                let jdExpressDisplay = jdExpress ? `Â¥${jdExpress.raw.toFixed(2)} (7æŠ˜: Â¥${jdExpress.discount.toFixed(2)})` : (weight<20?'éœ€â‰¥20kg':'æ— æ­¤åŸå¸‚');
                // å¾·é‚¦
                let debang = destProvince ? calcDebang(weight, destProvince) : null;
                // å£¹ç±³
                let yimi = destProvince ? calcYimi(weight, destProvince) : null;
                // é¡ºä¸°ç‰¹å¿«
                let sfExpress = destCity ? calcSFExpress(weight, destCity, dim) : null;
                // é¡ºä¸°æ ‡å¿«ï¼ˆé™†è¿ï¼‰
                let sfStandard = destCity ? calcSFStandard(weight, destCity, dim) : null;
                // è·¨è¶Š
                let kuayue = destCity ? calcKuayueBest(weight, destCity, dim) : null;
                // å®‰èƒ½
                let aneng = destProvince ? calcAneng(weight, destProvince) : null;

                let quotes = [
                    { name:'äº¬ä¸œæ ‡å¿«', price: jdNormal?.discount, display: jdNormalDisplay, remark: jdNormal?'7æŠ˜ä¼˜æƒ ':'æ— æŠ¥ä»·' },
                    { name:'äº¬ä¸œå¿«è¿', price: jdExpress?.discount, display: jdExpressDisplay, remark: jdExpressRemark },
                    { name:'å¾·é‚¦å¿«é€’', price: debang, display: debang?`Â¥${debang.toFixed(2)}`:'â€”â€”', remark: debang?'':'æ— æ­¤çœä»½' },
                    { name:'å£¹ç±³æ»´ç­”', price: yimi, display: yimi?`Â¥${yimi.toFixed(2)}`:'â€”â€”', remark: yimi?'ä¸è¶³30æŒ‰30kg':'æ— æ­¤çœä»½' },
                    { name:'é¡ºä¸°ç‰¹å¿«', price: sfExpress, display: sfExpress?`Â¥${sfExpress.toFixed(2)}`:'â€”â€”', remark: sfExpress?'OCRå‚è€ƒÂ·éå®é™…ä»·':'ä»…äº¬æ´¥æµé’å¤ªé•¿æ²»' },
                    { name:'é¡ºä¸°æ ‡å¿«', price: sfStandard, display: sfStandard?`Â¥${sfStandard.toFixed(2)}`:'â€”â€”', remark: sfStandard?'Excelè§£æÂ·éå®˜æ–¹':'æš‚æ— æ­¤æµå‘' },
                    { name:'è·¨è¶Šé€Ÿè¿', price: kuayue, display: kuayue?`Â¥${kuayue.toFixed(2)}`:'â€”â€”', remark: kuayue?'æœ€ä¼˜æ–¹æ¡ˆ':'æš‚æ— æ­¤æµå‘' },
                    { name:'å®‰èƒ½ç‰©æµ', price: aneng, display: aneng?`Â¥${aneng.toFixed(2)}`:'â€”â€”', remark: aneng?'å«é¢å•1å…ƒ':'æ— æ­¤çœä»½' }
                ];

                let html = '';
                quotes.forEach(q => {
                    html += `<div class="company-item">
                        <div class="company-left"><div class="logo">${q.name.charAt(0)}</div><div class="info"><h4>${q.name}</h4><span class="tag">${q.remark}</span></div></div>
                        <div class="price">${q.display} ${q.price ? '<small>å…ƒ</small>' : ''}</div>
                    </div>`;
                });
                document.getElementById('quoteList').innerHTML = html;

                // æ™ºé€‰å»ºè®®
                let valid = quotes.filter(q => q.price !== null && !isNaN(q.price) && q.price>0);
                let suggestionHTML = '';
                if (valid.length > 0) {
                    let sorted = [...valid].sort((a,b) => a.price - b.price);
                    let best = sorted[0];
                    let bestAvg = best.price / weight;
                    suggestionHTML += `<div class="best-highlight">`;
                    suggestionHTML += `<span style="font-size:16px; font-weight:600;">ğŸ† æœ€ä½³æ¨è</span><br>`;
                    suggestionHTML += `<span class="best-company">${best.name}</span> <span class="best-price">Â¥${best.price.toFixed(2)}</span> `;
                    suggestionHTML += `<span class="avg-price">(Â¥${bestAvg.toFixed(2)}/kg)</span><br>`;
                    suggestionHTML += `<span style="font-size:14px; color:#2d3c5e;">âœ… æ¯å…¬æ–¤æŠ˜åˆæœ€ä½ï¼Œæ¨èä½¿ç”¨</span>`;
                    suggestionHTML += `</div>`;

                    suggestionHTML += `<div style="margin-top:12px;"><span style="font-weight:600; font-size:14px;">ğŸ“Š å„å…¬å¸æ¯å…¬æ–¤å‡ä»·å¯¹æ¯”</span></div>`;
                    suggestionHTML += `<table class="compare-table">`;
                    suggestionHTML += `<thead><tr><th>å¿«é€’å…¬å¸</th><th>æ€»ä»· (å…ƒ)</th><th>æ¯å…¬æ–¤å‡ä»· (å…ƒ/kg)</th></tr></thead><tbody>`;
                    sorted.forEach(q => {
                        let avg = q.price / weight;
                        let rowClass = (q.name === best.name) ? 'highlight-row' : '';
                        suggestionHTML += `<tr class="${rowClass}"><td>${q.name}</td><td>Â¥${q.price.toFixed(2)}</td><td>Â¥${avg.toFixed(2)}</td></tr>`;
                    });
                    suggestionHTML += `</tbody></table>`;

                    if (matchedType === 'province') {
                        suggestionHTML += `<p style="margin-top:12px; color:#b45309; background:#fffbeb; padding:8px; border-radius:8px;">âš ï¸ æœªæ‰¾åˆ°å¯¹åº”å¸‚/è‡ªæ²»åŒºï¼Œå·²æŒ‰çœä»½ä»·æ ¼æŠ¥ä»·ï¼Œå®é™…å¯èƒ½æ›´ä½ã€‚</p>`;
                    }
                } else {
                    suggestionHTML = `<div style="padding:12px; color:#6b7280;">âŒ å½“å‰æ— æœ‰æ•ˆæŠ¥ä»·ï¼Œè¯·è°ƒæ•´ç›®çš„åœ°æˆ–è¡¥å……æ•°æ®ã€‚</div>`;
                }
                document.getElementById('suggestionText').innerHTML = suggestionHTML;
            }
            document.getElementById('quoteBtn').addEventListener('click', renderQuotes);
            window.onload = renderQuotes;
        })();
    </script>
</body>
</html>